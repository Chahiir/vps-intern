<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>d690767b-4846-44ac-bb3c-c54f86329e38</title>
    <meta name="author" content="hind vps" />
    <style type="text/css">
        * {
            margin: auto;
            padding: 0;
            text-indent: 0;
        }

        h1 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: italic;
            font-weight: bold;
            text-decoration: none;
            font-size: 11pt;
        }

        h2 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: italic;
            font-weight: bold;
            text-decoration: none;
            font-size: 7pt;
        }

        .s1 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 6pt;
        }

        .s2 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 6pt;
        }

        .s3 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: italic;
            font-weight: bold;
            text-decoration: none;
            font-size: 16px;
            margin-left: 5px;
        }

        .s4 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12px;
        }

        .s5 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 5.5pt;
        }

        .s6 {
            color: #f00;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 15px;
        }

        .p,
        p {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 8pt;
            margin: 0pt;
        }

        .s7 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 10.5pt;
        }

        table,
        tbody {
            vertical-align: top;
            overflow: visible;
        }

        .g1 {
            width: 140pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
        }

        .g2 {
            width: 51pt;
            border-right-style: solid;
            border-right-width: 1pt;
        }

        .g3 {
            width: 35pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
        }

        .g4 {
            width: 127pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
        }

        .g5 {
            width: 432pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
        }

        .g6 {
            padding-top: 2pt;
            padding-left: 1pt;
            text-indent: 0pt;
            text-align: left;
        }

        .g7 {
            padding-top: 3pt;
            padding-left: 1pt;
            text-indent: 0pt;
            text-align: left;
        }

        .g8 {
            width: 105pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
        }

        .g9 {
            width: 165pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
        }

        .g10 {
            width: 127pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
        }
        .page-break {
    page-break-after: always;
}
    </style>
</head>

<body>

    <div style="margin-left: 5% !important;width:100%">
      <h1 style="padding-top: 3pt; text-indent: 0pt;margin-left:30%">
        FICHE D&#39;EVALUATION
    </h1>
        <p style="padding-top: 7pt; text-indent: 0pt; text-align: left"><br /></p>
        <h2 style="padding-left: 100pt; text-indent: 0pt; text-align: left">
            Date de l&#39;entretien : {{ $notes->first()->created_at }}
        </h2>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <table style="border-collapse: collapse; margin-left: 81.2953pt;width:50%" cellspacing="0">
            <tr style="height: 13pt ;">
                <td class="g2">
                    <p class="s1" style="text-indent: 0pt; line-height: 7pt; text-align: left">
                        Nom de l&#39;employé :
                    </p>
                </td>
                <td class="g1" bgcolor="#DDEBF7">
                    <p style="text-indent: 0pt; text-align: left;margin-left:5px">
                        {{ $salarie->nom }} &nbsp; {{ $salarie->prenom }}</p>
                </td>
            </tr>
            <tr style="height: 13pt">
                <td class="g2">
                    <p class="s1" style="padding-top: 1pt; text-indent: 0pt; text-align: left">
                        Nom de l&#39;évaluateur :
                    </p>
                </td>
                <td class="g1" bgcolor="#DDEBF7">
                    <p style="text-indent: 0pt; text-align: left;margin-left:5px">
                        {{ $manager->nom }} &nbsp; {{ $manager->prenom }}
                    </p>
                </td>
            </tr>
            <tr style="height: 13pt">
                <td class="g2">
                    <p class="s1" style="padding-top: 1pt; text-indent: 0pt; text-align: left">
                        Poste occupé :
                    </p>
                </td>
                <td class="g1" bgcolor="#DDEBF7">
                    <p style="text-indent: 0pt; text-align: left;margin-left:5px">{{ $salarie->fonction }}</p>
                </td>
            </tr>
            <tr style="height: 13pt">
                <td class="g2">
                    <p class="s1" style="padding-top: 1pt; text-indent: 0pt; text-align: left">
                        Département :
                    </p>
                </td>
                <td class="g1" bgcolor="#DDEBF7">
                    <p style="text-indent: 0pt; text-align: left;margin-left:5px">{{ $salarie->service->name }}</p>
                </td>
            </tr>
            <tr style="height: 13pt">
                <td class="g2">
                    <p class="s1" style="padding-top: 1pt; text-indent: 0pt; text-align: left">
                        Date d&#39;entrée :
                    </p>
                </td>
                <td class="g1" bgcolor="#DDEBF7">
                    <p style="text-indent: 0pt; text-align: left;margin-left:5px">{{ \Carbon\Carbon::parse($salarie->date_debut)->format('d/m/Y') }} </p>
                </td>
            </tr>
            <tr style="height: 13pt">
                <td class="g2">
                    <p class="s1" style="padding-top: 1pt; text-indent: 0pt; text-align: left">
                        Ancienneté :
                    </p>
                </td>
                <td class="g1" bgcolor="#DDEBF7">
                    <p style="text-indent: 0pt; text-align: left;margin-left:5px">
                      {{ \App\Helpers\SalarierHelper::seniority($salarie->date_debut) }}
                    </p>
                </td>
            </tr>
            <tr style="height: 13pt">
                <td class="g2">
                    <p class="s1" style="padding-top: 1pt; text-indent: 0pt; text-align: left">
                        Période d&#39;évaluation :
                    </p>
                </td>
                <td class="g1" bgcolor="#DDEBF7">
                    <p class="s1" style="padding-left: 1pt; text-indent: 0pt; text-align: left;margin-left:5px">
                        {{ $notes->first()->annee }}
                    </p>
                </td>
            </tr>
        </table>
        <p style="padding-top: 3pt; text-indent: 0pt; text-align: left"><br /></p>
        <table style="border-collapse: collapse; margin-left:24%;width:56.5%" cellspacing="0">
            <tr style="height: 20pt">
                <td class="g3" bgcolor="#D9D9D9" style="width: 12%">
                    <p class="s1" style="padding-top: 6pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">
                        Note sur 5
                    </p>
                </td>
                <td
                    style="width: 33.5%;border-top-style: solid;border-top-width: 1pt;border-left-style: solid;border-left-width: 1pt;border-bottom-style: solid;border-bottom-width: 1pt;border-right-style: solid;border-right-width: 1pt;"bgcolor="#D9D9D9">
                    <p class="s1"
                        style=" padding-top: 6pt; padding-left: 34pt; text-indent: 0pt; text-align: left; ">
                        Appréciation
                    </p>
                </td>
                <td style=" border-top-style: solid; border-top-width: 1pt; border-left-style: solid; border-left-width: 1pt; border-bottom-style: solid; border-bottom-width: 1pt; border-right-style: solid; border-right-width: 1pt; "
                    bgcolor="#D9D9D9">
                    <p class="s1" style="padding-top: 6pt; text-indent: 0pt; text-align: center">
                        Remarques
                    </p>
                </td>
            </tr>
        </table>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        @foreach ($groupedSubCategories as $noteCategoryId => $subCategories)
            <table style="border-collapse: collapse; margin-left: 5.354pt;margin-bottom:2%;text-align:center;width:80%"
                cellspacing="0">
                @php
                    $noteCategorie = App\Models\NoteCategorie::find($noteCategoryId);
                @endphp
                <tr style="height: 15pt">
                    <td class="g5" colspan="4" bgcolor="#F1F1F1">
                        <p class="s3 g6">{{ $noteCategorie->name }}</p>
                    </td>
                </tr>
                @foreach ($subCategories as $subCategory)
                    @php
                        $note = $groupedNotes->get($subCategory->id)->first();
                    @endphp
                    <tr style="height: 15pt">
                        <td class="g4">
                            <p class="s4 g7">{{ $subCategory->name }}</p>
                        </td>
                        <td class="g3">
                            <span class="note" data-category-id="{{ $noteCategoryId }}"
                                data-subcategory-id="{{ $subCategory->id }}">{{ $note->note ?? '' }}</span>
                        </td>

                          {{ \App\Helpers\PdfHelper::appreciation($note->note) }}
                        <td class="g9">
                            <p style="text-indent: 0pt; text-align: center;margin-left:5px">
                                {{ $note->remarque ?? '' }}</p>
                        </td>
                    </tr>
                @endforeach
                <tr style="height: 15pt">
                    <td class="g4" bgcolor="#F1F1F1">
                        <p class="s4 g7" style="text-align:right;margin-right:5px!important"><b> Note
                                {{ $noteCategorie->name }}</b></p>
                    </td>
                    <td class="g3">
                        <span id="average-note-{{ $noteCategoryId }}" class="average-note">
                          {{ $categoryAverages[$noteCategoryId] }}
                        </span>
                    </td>
                    <td class="g8">
                        <p style="text-indent: 0pt; text-align: center;margin-left:5px">

                        </p>
                    </td>
                    <td class="g9">
                        <p style="text-indent: 0pt; text-align: center;margin-left:5px"></p>
                    </td>
                </tr>
            </table>
        @endforeach




        <div class="textbox"
            style=" border: 0.5pt solid #000000; display: block; min-height: 17.4pt; width: 80%; float: left; margin-left:5px; ">
            <div class="s6" style=" padding-top: 4pt; padding-left: 36pt; text-indent: 0pt; ">
                MOYENNE FINALE SUR 5 :
                <b id="finale-note" style="color:black !important;font-size:15px">{{ $remarques->note_final }}</b>
            </div>
        </div>
        <div class="page-break"></div>
        <br><br>
        <p style=" text-indent: 0pt; text-align: left" />
        <p style="margin-left:5px;padding-bottom:5px; padding-top: 3pt; padding-left: 5pt; text-indent: 0pt; text-align: left;background-color: #dbdbdb;width:80%" >
            <span class="p" > Points forts </span>
        </p>
        <p style="text-indent: 0pt; text-align: left;margin:10px 0px 10px 10px">{{ $remarques->point_fort ?? "Pas de Remarque" }}</p>
        <p style="margin-left:5px;padding-bottom:5px; padding-top: 3pt; padding-left: 5pt; text-indent: 0pt; text-align: left;background-color: #dbdbdb;width:80%">
            <span class="p" style="background-color: #dbdbdb">
                Points à améliorer
            </span>
        </p>
        <p style="text-indent: 0pt; text-align: left;margin:10px 0px 10px 10px">{{ $remarques->point_ameliorer ?? "Pas de Remarque" }}</p>
        <p style="margin-left:5px;padding-bottom:5px; padding-top: 3pt; padding-left: 5pt; text-indent: 0pt; text-align: left;background-color: #dbdbdb;width:80%">
            <span class="p" style="background-color: #dbdbdb">
                Projet professionnel et perspectives
            </span>
        </p>
        <p style="text-indent: 0pt; text-align: left;margin:10px 0px 10px 10px">{{ $remarques->projet ?? "Pas de Remarque" }}</p>
        <p style="margin-left:5px;padding-bottom:5px; padding-top: 3pt; padding-left: 5pt; text-indent: 0pt; text-align: left;background-color: #dbdbdb;width:80%">
            <span class="p" style="background-color: #dbdbdb">
                Actions pour la période à venir
            </span>
        </p>
        <p style="text-indent: 0pt; text-align: left;margin:10px 0px 10px 10px">{{ $remarques->action ?? "Pas de Remarque" }}</p>
        <p style="margin-left:5px;padding-bottom:5px; padding-top: 3pt; padding-left: 5pt; text-indent: 0pt; text-align: left;background-color: #dbdbdb;width:80%">
            <span class="p" style="background-color: #dbdbdb"> Commentaires </span>
        </p>
        <p style="text-indent: 0pt; text-align: left;margin:10px 0px 10px 10px">{{ $remarques->commentaire ?? "Pas de Remarque" }}</p>
        <p class="s7" style="padding-left: 6pt; text-indent: 0pt; text-align: left;margin-top:15px;float:left">
            Signature de l&#39;Employé
        </p>
        <p class="s7" style="padding-left: 6pt; text-indent: 0pt; text-align: center;margin-top:25px;">
            Signature de l&#39;Evaluateurs
        </p>
    </div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const noteElements = document.querySelectorAll('.note');
        noteElements.forEach(span => {
            handleNoteChange(span);
        });
    });

    function handleNoteChange(span) {
        const categoryId = span.getAttribute('data-category-id');
        const subcategoryId = span.getAttribute('data-subcategory-id');
        const value = parseFloat(span.innerText);

        updateAppreciation(subcategoryId, value);
        updateAverage(categoryId);
    }


    function updateAverage(categoryId) {
        const noteElements = document.querySelectorAll(`.note[data-category-id='${categoryId}']`);
        let total = 0;
        let count = 0;

        noteElements.forEach(span => {
            const value = parseFloat(span.innerText);
            if (!isNaN(value)) {
                total += value;
                count++;
            }
        });

        const average = (count === 0) ? 0 : (total / count).toFixed(2);
        document.getElementById(`average-note-${categoryId}`).innerText = average;
        calculateFinalNote();
    }

    function calculateFinalNote() {
    const averageSpans = document.querySelectorAll('.average-note');
    let sum = 0;
    let count = 0;

    averageSpans.forEach(span => {
        const value = parseFloat(span.innerText);
        if (!isNaN(value) && value !== '') {
            sum += value;
            count++;
        }
    });

    const finalNote = count > 0 ? (sum / count).toFixed(2) : '';
    const finalNoteElement = document.getElementById('finale-note');
    if (finalNoteElement) {
        finalNoteElement.innerText = finalNote;
    }
}
</script>

</html>
